<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Форма обратной связи</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .feedback-container {
            max-width: 600px;
            margin: 2rem auto;
            padding: 2rem;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }

        .form-label {
            font-weight: 500;
        }

        .invalid-feedback {
            display: block;
        }

        .success-message {
            color: #198754;
            font-weight: 500;
        }

        .error-message {
            color: #dc3545;
            font-weight: 500;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="feedback-container">
        <h2 class="text-center mb-4">Связаться с нами</h2>

        <!-- Сообщения об успехе/ошибке -->
        <div th:if="${successMessage}" class="alert alert-success" role="alert">
            <span th:text="${successMessage}"></span>
        </div>
        <div th:if="${errorMessage}" class="alert alert-danger" role="alert">
            <span th:text="${errorMessage}"></span>
        </div>

        <form method="post" th:action="@{/feedback/send}" th:object="${feedbackDto}" novalidate>
            <!-- Имя -->
            <div class="mb-3">
                <label for="name" class="form-label">Имя *</label>
                <input type="text"
                       class="form-control"
                       id="name"
                       th:field="*{name}"
                       required
                       minlength="2">
                <div class="invalid-feedback" th:if="${#fields.hasErrors('name')}">
                    <span th:errors="*{name}"></span>
                </div>
            </div>

            <!-- Телефон -->
            <div class="mb-3">
                <label for="phone" class="form-label">Телефон *</label>
                <input type="tel"
                       class="form-control"
                       id="phone"
                       th:field="*{phone}"
                       pattern="(\+?[78][\s-(]?[0-9]{3}[\s-)]?)?(\d{3})[\s-]?(\d{2})[\s-]?(\d{2})"
                       required
                       placeholder="+7 (999) 123-45-67">
                <div class="invalid-feedback" th:if="${#fields.hasErrors('phone')}">
                    <span th:errors="*{phone}"></span>
                </div>
                <div class="form-text">Формат: +7 (999) 123-45-67 или 89991234567</div>
            </div>

            <!-- Email -->
            <div class="mb-3">
                <label for="email" class="form-label">Email *</label>
                <input type="email"
                       class="form-control"
                       id="email"
                       th:field="*{email}"
                       pattern="^(?=.{1,64}@)[A-Za-z0-9_-]+(\\.[A-Za-z0-9_-]+)*@[^-][A-Za-z0-9-]+(\\.[A-Za-z0-9-]+)*(\\.[A-Za-z]{2,})$"
                       required
                       placeholder="example@mail.ru">
                <div class="invalid-feedback" th:if="${#fields.hasErrors('email')}">
                    <span th:errors="*{email}"></span>
                </div>
            </div>

            <!-- Выпадающий список для enum -->
            <div class="mb-3">
                <label for="subjectRequest" class="form-label">Тема обращения *</label>
                <select class="form-select"
                        id="subjectRequest"
                        th:field="*{subjectRequest}"
                        required>
                    <option value="">Выберите тему</option>
                    <option th:each="subject : ${subjects}"
                            th:value="${subject}"
                            th:text="${subject.value}">
                    </option>
                </select>
                <div class="invalid-feedback" th:if="${#fields.hasErrors('subjectRequest')}">
                    <span th:errors="*{subjectRequest}"></span>
                </div>
            </div>

            <!-- Сообщение -->
            <div class="mb-3">
                <label for="message" class="form-label">Сообщение</label>
                <textarea class="form-control"
                          id="message"
                          th:field="*{message}"
                          rows="4"
                          placeholder="Опишите вашу проблему или вопрос..."></textarea>
            </div>

            <button type="submit" class="btn btn-primary w-100">Отправить обращение</button>
        </form>
    </div>
</div>

<!-- JavaScript для валидации в реальном времени -->
<script>
    // Валидация формы на стороне клиента
    (function () {
        'use strict';

        const forms = document.querySelectorAll('.needs-validation');

        // Проверка email в реальном времени
        const emailInput = document.getElementById('email');
        if (emailInput) {
            emailInput.addEventListener('input', function () {
                const emailPattern = new RegExp(emailInput.pattern);
                if (emailInput.value && !emailPattern.test(emailInput.value)) {
                    emailInput.classList.add('is-invalid');
                } else {
                    emailInput.classList.remove('is-invalid');
                }
            });
        }

        // Проверка телефона в реальном времени
        const phoneInput = document.getElementById('phone');
        if (phoneInput) {
            phoneInput.addEventListener('input', function () {
                const phonePattern = new RegExp(phoneInput.pattern);
                if (phoneInput.value && !phonePattern.test(phoneInput.value)) {
                    phoneInput.classList.add('is-invalid');
                } else {
                    phoneInput.classList.remove('is-invalid');
                }
            });
        }

        // Форматирование телефона
        if (phoneInput) {
            phoneInput.addEventListener('blur', function () {
                let phone = this.value.replace(/\D/g, '');
                if (phone.startsWith('7') || phone.startsWith('8')) {
                    phone = phone.substring(1);
                }
                if (phone.length === 10) {
                    this.value = '+7 (' + phone.substring(0, 3) + ') ' +
                        phone.substring(3, 6) + '-' +
                        phone.substring(6, 8) + '-' +
                        phone.substring(8, 10);
                }
            });
        }

    })();
</script>
</body>
</html>